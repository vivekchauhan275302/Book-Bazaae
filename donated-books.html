<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Donated & Free Books - Book Bazaar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  
  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-analytics.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB3SpaaRcXlz5tyQPqsyG0KUDMlGPuy51Q",
      authDomain: "bookbazar-c2b8f.firebaseapp.com",
      projectId: "bookbazar-c2b8f",
      storageBucket: "bookbazar-c2b8f.firebasestorage.app",
      messagingSenderId: "879607459223",
      appId: "1:879607459223:web:8d866d79bd8622a44728d2",
      measurementId: "G-0WB4QMGTMB"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    
    // Make auth and db available globally
    window.auth = getAuth(app);
    window.db = getFirestore(app);
  </script>
</head>
<body class="bg-gray-50">

  <!-- Simplified Navbar -->
  <nav class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex-shrink-0">
          <a href="index.html" class="flex items-center">
            <span class="text-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent flex items-center">
              <i class="ph ph-books text-2xl mr-2"></i> Book Bazaar
            </span>
          </a>
        </div>
        <div class="hidden md:block">
          <div class="ml-10 flex items-center space-x-8">
            <a href="fiction.html" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Fiction</a>
            <a href="non-fiction.html" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Non-Fiction</a>
            <a href="science.html" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Science</a>
            <a href="sacred-texts.html" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Holy Books</a>
            <a href="children.html" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Children</a>
            <a href="business.html" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Business</a>
            <a href="donated-books.html" class="nav-link text-blue-600 border-b-2 border-blue-600 font-medium">Donated Books</a>
          </div>
        </div>
        <div>
          <a href="cart.html" class="relative text-gray-700 hover:text-blue-600 transition-colors">
            <i class="ph ph-shopping-cart text-xl"></i>
            <span class="absolute -top-2 -right-2 bg-blue-600 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full font-medium">0</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Page Header -->
  <div class="bg-gradient-to-r from-green-600 to-emerald-500 text-white">
    <div class="max-w-7xl mx-auto px-4 py-12 sm:px-6 lg:px-8">
      <h1 class="text-3xl font-bold">Donated & Free Books</h1>
      <p class="mt-2">Discover pre-loved books donated by the community - pay nothing or choose to donate</p>
    </div>
  </div>

  <!-- Book Categories -->
  <div class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
    <div class="flex flex-wrap gap-4 mb-8">
      <a href="#" class="px-4 py-2 bg-green-600 text-white rounded-full text-sm font-medium">All Free Books</a>
      <a href="#" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-full text-sm font-medium">Old Books</a>
      <a href="#" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-full text-sm font-medium">Donated Classics</a>
      <a href="#" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-full text-sm font-medium">Second-hand Academic</a>
      <a href="#" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-full text-sm font-medium">Children's Books</a>
      <a href="#" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-full text-sm font-medium">Low-cost Books</a>
      <a href="#donate" class="px-4 py-2 bg-yellow-500 text-white rounded-full text-sm font-medium">Donate Books</a>
    </div>
  </div>

  <!-- Featured Free Books -->
  <div class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
    <h2 class="text-2xl font-bold mb-6">Featured Free Books (₹0.0)</h2>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      <!-- Book Card 1 -->
      <div class="book-card bg-white rounded-lg shadow-md overflow-hidden">
        <img class="w-full h-56 object-cover" src="https://images.unsplash.com/photo-1544947950-fa07a98d237f" alt="To Kill a Mockingbird">
        <div class="p-4">
          <h3 class="text-lg font-semibold">To Kill a Mockingbird</h3>
          <p class="text-sm text-gray-600">Harper Lee (Used)</p>
          <div class="mt-4 flex justify-between items-center">
            <span class="text-green-600 font-bold">₹0.0</span>
            <div class="flex space-x-2">
              <button class="cart-btn bg-green-600 text-white px-3 py-1 rounded-full text-sm"
                data-id="mockingbird-free" 
                data-name="To Kill a Mockingbird" 
                data-price="0" 
                data-image="https://images.unsplash.com/photo-1544947950-fa07a98d237f">
                Claim Book
              </button>
            </div>
          </div>
          <div class="mt-2 text-xs text-gray-500">
            <p>Condition: Good - Minor wear on cover</p>
            <p>Donated by: Aarav M.</p>
          </div>
        </div>
      </div>
      
      <!-- Book Card 2 -->
      <div class="book-card bg-white rounded-lg shadow-md overflow-hidden">
        <img class="w-full h-56 object-cover" src="https://images.unsplash.com/photo-1629992101753-56d196c8aabb" alt="The Great Gatsby">
        <div class="p-4">
          <h3 class="text-lg font-semibold">The Great Gatsby</h3>
          <p class="text-sm text-gray-600">F. Scott Fitzgerald (Used)</p>
          <div class="mt-4 flex justify-between items-center">
            <span class="text-green-600 font-bold">₹0.0</span>
            <div class="flex space-x-2">
              <button class="cart-btn bg-green-600 text-white px-3 py-1 rounded-full text-sm"
                data-id="gatsby-free" 
                data-name="The Great Gatsby" 
                data-price="0" 
                data-image="https://images.unsplash.com/photo-1629992101753-56d196c8aabb">
                Claim Book
              </button>
            </div>
          </div>
          <div class="mt-2 text-xs text-gray-500">
            <p>Condition: Very Good - Barely used</p>
            <p>Donated by: Priya S.</p>
          </div>
        </div>
      </div>
      
      <!-- Book Card 3 -->
      <div class="book-card bg-white rounded-lg shadow-md overflow-hidden">
        <img class="w-full h-56 object-cover" src="https://images.unsplash.com/photo-1541963463532-d68292c34b19" alt="Pride and Prejudice">
        <div class="p-4">
          <h3 class="text-lg font-semibold">Pride and Prejudice</h3>
          <p class="text-sm text-gray-600">Jane Austen (Used)</p>
          <div class="mt-4 flex justify-between items-center">
            <span class="text-green-600 font-bold">₹0.0</span>
            <div class="flex space-x-2">
              <button class="cart-btn bg-green-600 text-white px-3 py-1 rounded-full text-sm"
                data-id="pride-prejudice-free" 
                data-name="Pride and Prejudice" 
                data-price="0" 
                data-image="https://images.unsplash.com/photo-1541963463532-d68292c34b19">
                Claim Book
              </button>
            </div>
          </div>
          <div class="mt-2 text-xs text-gray-500">
            <p>Condition: Fair - Some notes inside</p>
            <p>Donated by: Rahul J.</p>
          </div>
        </div>
      </div>
      
      <!-- Book Card 4 -->
      <div class="book-card bg-white rounded-lg shadow-md overflow-hidden">
        <img class="w-full h-56 object-cover" src="https://images.unsplash.com/photo-1495640388908-05fa85288e61" alt="1984">
        <div class="p-4">
          <h3 class="text-lg font-semibold">1984</h3>
          <p class="text-sm text-gray-600">George Orwell (Used)</p>
          <div class="mt-4 flex justify-between items-center">
            <span class="text-green-600 font-bold">₹0.0</span>
            <div class="flex space-x-2">
              <button class="cart-btn bg-green-600 text-white px-3 py-1 rounded-full text-sm"
                data-id="1984-free" 
                data-name="1984" 
                data-price="0" 
                data-image="https://images.unsplash.com/photo-1495640388908-05fa85288e61">
                Claim Book
              </button>
            </div>
          </div>
          <div class="mt-2 text-xs text-gray-500">
            <p>Condition: Good - Slight yellowing</p>
            <p>Donated by: Neha K.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- How It Works Section -->
  <div class="bg-gray-100 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-2xl font-bold mb-8 text-center">How Our Book Donation Program Works</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="bg-white p-6 rounded-lg shadow-md text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="ph ph-gift text-green-600 text-2xl"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">1. Book Donations</h3>
          <p class="text-gray-600">Community members donate books they no longer need, creating a cycle of shared knowledge.</p>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="ph ph-book-open-text text-green-600 text-2xl"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">2. Free Distribution</h3>
          <p class="text-gray-600">We make these books available at ₹0.0 to ensure everyone has access to literature and knowledge.</p>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="ph ph-arrows-clockwise text-green-600 text-2xl"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">3. Continue the Cycle</h3>
          <p class="text-gray-600">After reading, consider donating the book back so others can enjoy it too!</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Donate Your Books Section -->
  <div id="donate" class="max-w-7xl mx-auto px-4 py-16 sm:px-6 lg:px-8">
    <div class="bg-yellow-50 rounded-lg p-8 border border-yellow-200 shadow-sm">
      <h2 class="text-2xl font-bold mb-4">Donate Your Books</h2>
      <p class="mb-6 text-gray-700">Have books you no longer need? Consider donating them to help others access literature and information. Your donation makes a difference!</p>
      
      <form class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
          <input type="text" id="name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Full Name">
        </div>
        
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="email@example.com">
        </div>
        
        <div>
          <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
          <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Your contact number">
        </div>
        
        <div>
          <label for="book-count" class="block text-sm font-medium text-gray-700 mb-1">Number of Books</label>
          <select id="book-count" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
            <option value="1-5">1-5 books</option>
            <option value="6-10">6-10 books</option>
            <option value="11-20">11-20 books</option>
            <option value="21+">21+ books</option>
          </select>
        </div>
        
        <div class="md:col-span-2">
          <label for="book-details" class="block text-sm font-medium text-gray-700 mb-1">Book Details (titles, conditions)</label>
          <textarea id="book-details" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Please provide details about the books you wish to donate"></textarea>
        </div>
        
        <div class="md:col-span-2">
          <button type="submit" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
            <i class="ph ph-heart mr-2"></i> Submit Donation Request
          </button>
          <p class="mt-2 text-sm text-gray-500">Our team will contact you to arrange pickup or drop-off.</p>
        </div>
      </form>
    </div>
  </div>

  <!-- Simplified Footer -->
  <footer class="bg-gray-900 text-white py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <p>&copy; 2023 Book Bazaar. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Cart functionality script -->
  <script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
    import { getFirestore, doc, updateDoc, arrayUnion, getDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    const auth = window.auth;
    const db = window.db;
    
    // Setup cart functionality when DOM is loaded
    document.addEventListener('DOMContentLoaded', setupCartButtons);
    
    // Update cart count when auth state changes
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        try {
          const userRef = doc(db, "users", user.uid);
          const userDoc = await getDoc(userRef);
          
          if (userDoc.exists() && userDoc.data().cart) {
            const cartCount = userDoc.data().cart.length;
            // Update cart count in navbar
            const cartCountElement = document.querySelector('.ph-shopping-cart + span');
            if (cartCountElement) {
              cartCountElement.textContent = cartCount;
            }
          }
        } catch (error) {
          console.error("Error getting cart count:", error);
        }
      }
    });

    function setupCartButtons() {
      const cartButtons = document.querySelectorAll('.cart-btn');
      
      cartButtons.forEach(button => {
        // Remove any existing click handlers to prevent duplicates
        button.removeEventListener('click', handleCartButtonClick);
        // Add the click handler
        button.addEventListener('click', handleCartButtonClick);
      });
    }
    
    async function handleCartButtonClick(e) {
      // Check if user is logged in
      const user = auth.currentUser;
      if (!user) {
        alert('Please login to claim this book');
        window.location.href = 'login.html';
        return;
      }
      
      // Get button that was clicked
      const button = e.currentTarget;
      
      // Get book details from data attributes
      const bookId = button.dataset.id;
      const bookName = button.dataset.name;
      const bookPrice = button.dataset.price;
      const bookImage = button.dataset.image;
      
      if (!bookId || !bookName || !bookPrice || !bookImage) {
        console.error("Missing data attributes on cart button", button);
        alert('There was an error claiming this book. Please try again.');
        return;
      }
      
      try {
        // Reference to user document
        const userRef = doc(db, "users", user.uid);
        
        // Get current cart items
        const userDoc = await getDoc(userRef);
        
        if (!userDoc.exists()) {
          console.error("User document doesn't exist");
          return;
        }
        
        // Check if item already exists in cart
        const userCart = userDoc.data().cart || [];
        const existingItemIndex = userCart.findIndex(item => item.bookId === bookId);
        
        if (existingItemIndex >= 0) {
          // Item exists, increment quantity
          userCart[existingItemIndex].quantity += 1;
          await updateDoc(userRef, { cart: userCart });
        } else {
          // Add new item to cart
          await updateDoc(userRef, {
            cart: arrayUnion({
              bookId,
              bookName,
              price: bookPrice,
              image: bookImage,
              quantity: 1,
              addedAt: new Date().toISOString()
            })
          });
        }
        
        // Show confirmation to user
        alert(`${bookName} has been claimed! You can pick it up at our store.`);
        
        // Update cart count in navbar
        const cartCountElement = document.querySelector('.ph-shopping-cart + span');
        if (cartCountElement) {
          const currentCount = parseInt(cartCountElement.textContent);
          cartCountElement.textContent = existingItemIndex >= 0 ? currentCount : currentCount + 1;
        }
        
      } catch (error) {
        console.error("Error claiming book:", error);
        alert('There was an error claiming this book. Please try again.');
      }
    }
  </script>
</body>
</html> 